{"id": "rule-global-directives", "content": "You are assembling a Jac language reference. Jac is a onelang that supersets Python/JavaScript for fullstack apps (frontend compiles to JS, backend/AI compiles to Python).\n\nHARD TARGET: 18-22KB. You MUST stay under 22KB. Count your output size. If you exceed 22KB, you have failed.\n\nOUTPUT FORMAT: Markdown (.md file).\n\nFORMAT RULES:\n- Short declarative statements, not explanations\n- Show syntax, then example. No \"as in\" or \"for example\"\n- Group related items with semicolons on ONE line\n- Use ```jac fenced code blocks for code examples and patterns\n- Inline code with backticks for syntax references in prose lines\n- One line per concept where possible\n- WRONG/RIGHT pairs: show only the code, minimal words\n- Patterns: 3 patterns max, each under 80 lines. No verbose comments.\n\nSTRUCTURE EACH TOPIC:\nTopic: brief definition\nSyntax: pattern\nExample: code\n(Optional) Common error: wrong -> right", "topic_ids": ["global"], "construct_types": ["general"], "priority": 1, "category": "global_directive"}
{"id": "rule-syntax-001", "content": "- CLI: jac start file.jac (not jac serve); jac check file.jac (may have false positives/negatives)", "topic_ids": ["api"], "construct_types": ["api"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-002", "content": "- Top-level: only declarations allowed. Executable statements MUST go inside with entry { } or a function body.", "topic_ids": ["abilities"], "construct_types": ["def", "try_except"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-003", "content": "- Entry: with entry { } not entry { }", "topic_ids": ["abilities"], "construct_types": ["try_except"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-004", "content": "- Spawn: BOTH forms valid: root spawn Walker(); AND Walker() spawn root; (use root or variable, NEVER bare keyword node)", "topic_ids": ["walkers"], "construct_types": ["node", "walker", "spawn"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-005", "content": "- Import: import from module { sym } (NO semicolon after }); import module; (semicolon for plain import). Wrong: import from math, sqrt; No import:py or import:jac exists.", "topic_ids": ["control", "imports"], "construct_types": ["import"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-006", "content": "- LLM: def f() -> T by llm; OR by llm(); both valid. by llm(temperature=0.7) for params. No import needed.", "topic_ids": ["control", "functions", "imports", "by_llm"], "construct_types": ["by_llm", "def", "import"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-007", "content": "- Access: has:priv x OR has :priv x (both valid); only :pub :priv :protect", "topic_ids": ["access"], "construct_types": ["auth"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-008", "content": "- Permissions: node.__jac__.grant(root, Perm)", "topic_ids": ["general"], "construct_types": ["node", "permissions"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-009", "content": "- Specs: obj __specs__ { static has methods: list = [...]; } __specs__ controls methods/path/websocket ONLY, NOT auth.", "topic_ids": ["archetypes", "api"], "construct_types": ["obj", "websocket", "api", "auth"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-010", "content": "- Walker auth: :pub on walker declaration = public (no auth). Without :pub = requires auth token. WRONG: static has auth: bool = False; in __specs__.", "topic_ids": ["types", "archetypes", "access", "api"], "construct_types": ["walker", "api", "auth"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-011", "content": "- :pub walker root access: READ-ONLY. Graph writes silently fail when here is root. Use built-in auth for write access.", "topic_ids": ["control", "archetypes", "access"], "construct_types": ["walker", "auth"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-012", "content": "- Custom auth: make ALL walkers :pub, handle auth manually inside walker body.", "topic_ids": ["archetypes", "access"], "construct_types": ["walker", "auth"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-013", "content": "- Methods: can for abilities (with entry/exit), def for regular methods", "topic_ids": ["control", "functions", "abilities"], "construct_types": ["can", "def", "try_except"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-014", "content": "- Root type: Root (capital R) in event clauses. Backtick `root REMOVED. Union: can act with Root | MyNode entry { }", "topic_ids": ["archetypes", "abilities"], "construct_types": ["node", "can", "try_except"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-015", "content": "- Filters: [-->](?:Type); [-->](?:Type, attr==val). Old (`?Type) REMOVED. Comma separator.", "topic_ids": ["graph"], "construct_types": ["traverse", "filter"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-016", "content": "- CLI: jac create --use client (not fullstack); jac add --npm; jac install syncs all; jac start --scale (no -t)", "topic_ids": ["api"], "construct_types": ["api", "client"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-017", "content": "- Optionals: str | None, not str?", "topic_ids": ["types"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-018", "content": "- Booleans: True/False (true/false pass syntax but FAIL at runtime)", "topic_ids": ["types"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-019", "content": "- Lambdas: Expression: lambda x: int -> int : x * 2; Block: lambda x: int -> int { return x * 2; }; Block REQUIRES return. Expression cannot have assignments.", "topic_ids": ["types", "functions"], "construct_types": ["def"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-020", "content": "- Tuple unpacking: (a, b) = func(); parens required", "topic_ids": ["general"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-021", "content": "- No pass keyword: use {} or comment", "topic_ids": ["general"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-022", "content": "- Enumerate: for (i, x) in enumerate(items) { }; parens required", "topic_ids": ["control"], "construct_types": ["enum"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-023", "content": "- Match/case: case V: stmt; (COLON not braces). Wrong: case 1 { }", "topic_ids": ["control"], "construct_types": ["match"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-024", "content": "- Typed edge CONNECT: a +>: E() :+> b; Wrong: a ++> E() ++> b (++> only untyped)", "topic_ids": ["archetypes", "graph"], "construct_types": ["edge", "connect"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-025", "content": "- Typed edge TRAVERSE: [->:E:->] Wrong: [-->:E:] (--> only untyped)", "topic_ids": ["archetypes", "graph"], "construct_types": ["edge", "traverse"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-026", "content": "- Chained: [->:E1:->->:E2:->] Wrong: [-->:E1:->-->:E2:->]", "topic_ids": ["graph"], "construct_types": ["traverse"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-027", "content": "- Edge attr filter: [->:Friend:since > 2020:->]", "topic_ids": ["archetypes", "graph"], "construct_types": ["edge", "traverse", "filter"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-028", "content": "- Disconnect: a del--> b; Wrong: del a --> b;", "topic_ids": ["graph"], "construct_types": ["connect", "traverse"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-029", "content": "- Untyped returns list: a ++> Node() returns list; use [0] for single", "topic_ids": ["control", "graph"], "construct_types": ["node", "connect"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-030", "content": "- Variable node traversal: [node_var ->:E:->] traverses from specific node", "topic_ids": ["archetypes", "graph"], "construct_types": ["node", "traverse"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-031", "content": "- Globals: glob var: T = val; at module level. Access by name in functions. WRONG: glob counter; inside function body.", "topic_ids": ["functions"], "construct_types": ["def", "glob"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-032", "content": "- Lambda as arg: items.sort(key=lambda x: dict -> float : x[\"v\"]);", "topic_ids": ["types", "functions"], "construct_types": ["def"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-033", "content": "- Try/except: try { } except Type as e { } finally { }; except not catch", "topic_ids": ["general"], "construct_types": ["try_except"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-034", "content": "- Inheritance: obj Child(Parent) { }; walker W(BaseW) { }", "topic_ids": ["archetypes"], "construct_types": ["walker", "obj"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-035", "content": "- Pipe: \"hello\" |> print;", "topic_ids": ["types", "functions"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-036", "content": "- Impl blocks: impl W.ability { code }", "topic_ids": ["general"], "construct_types": ["can"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-037", "content": "- Postinit: has f: T by postinit; def postinit { self.f = val; }", "topic_ids": ["functions"], "construct_types": ["def"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-038", "content": "- Walrus: root +>: E() :+> (end := A(val=10));", "topic_ids": ["graph"], "construct_types": ["connect"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-039", "content": "- Backward typed: a <+: E() :<+ b; [<-:E:<-]", "topic_ids": ["general"], "construct_types": ["connect", "traverse"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-040", "content": "- List concat in cl{}: use items.append(x) not items = items + [x] (cl{} only)", "topic_ids": ["jsx_client"], "construct_types": ["jsx", "client"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-041", "content": "- Reserved keywords: obj node walker edge enum can has -- NEVER use as variable names", "topic_ids": ["archetypes", "abilities"], "construct_types": ["node", "edge", "walker", "obj", "enum", "can"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-042", "content": "- Attribute ordering: non-default BEFORE default. Wrong: has x: int = 0; has y: str;", "topic_ids": ["types"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-043", "content": "- Test names: identifiers not strings. Wrong: test \"name\" { }", "topic_ids": ["types", "testing"], "construct_types": ["testing"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-044", "content": "- Fullstack entry: cl{} def:pub app must match [serve] base_route_app in jac.toml", "topic_ids": ["control", "access", "jsx_client", "routing"], "construct_types": ["match", "try_except", "jsx", "client", "auth", "routing", "jac_toml"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-045", "content": "- .cl.jac auto client-side (no cl{} wrapper). Do NOT include via include.", "topic_ids": ["jsx_client"], "construct_types": ["jsx", "client"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-046", "content": "- Dev ports: --port Vite frontend (8000); --api_port backend (8001, auto-proxied)", "topic_ids": ["general"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-047", "content": "- No ternary ?: -- use (expr) if cond else (expr)", "topic_ids": ["control"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-048", "content": "- cl{} JS builtins: .length not len(); String(x) not str(x); parseInt(x) not int(x); Math.min/max; .trim() not .strip(); no range(); no f-strings (use +); no tuple unpacking; no new keyword; className not class", "topic_ids": ["types", "jsx_client"], "construct_types": ["jsx", "client"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-049", "content": "- sv import prefix for server imports in .cl.jac", "topic_ids": ["control", "imports", "jsx_client"], "construct_types": ["import", "jsx", "client"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-050", "content": "- Lifecycle: useEffect(lambda -> None { func(); }, []) not can with entry", "topic_ids": ["functions", "abilities", "jsx_client"], "construct_types": ["can", "def", "try_except", "jsx"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-051", "content": "- root spawn compiles to await; function MUST be async def", "topic_ids": ["walkers"], "construct_types": ["walker", "spawn", "def", "async"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-052", "content": "- root spawn sends POST; walker __specs__ MUST include \"POST\"", "topic_ids": ["archetypes", "walkers", "api"], "construct_types": ["walker", "spawn", "api"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-053", "content": "- CSS: import \"./styles.css\";", "topic_ids": ["imports"], "construct_types": ["import"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-054", "content": "- .jac/ auto-generated, never modify manually", "topic_ids": ["general"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-055", "content": "- include in __init__.jac: full dotted paths (include pkg.module;)", "topic_ids": ["general"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-056", "content": "- npm deps: ALL in jac.toml; NEVER npm install in .jac/client/", "topic_ids": ["general"], "construct_types": ["client", "jac_toml"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-057", "content": "- Tailwind v4: tailwindcss + @tailwindcss/postcss in [dependencies.npm]", "topic_ids": ["general"], "construct_types": ["jac_toml"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-058", "content": "- .env: not auto-loaded; use glob _: bool = load_dotenv() or True;", "topic_ids": ["types", "functions"], "construct_types": ["glob", "env"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-059", "content": "- Empty lambda: lambda e: any -> None { 0; } not {}", "topic_ids": ["functions"], "construct_types": ["def"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-syntax-060", "content": "- Docstrings before declarations, not inside bodies", "topic_ids": ["types"], "construct_types": ["general"], "priority": 1, "category": "syntax_rule"}
{"id": "rule-topic-control", "content": "2. CONTROL: if/elif/else; for; while; match/case (colon!); try/except (not catch); no ternary; no pass", "topic_ids": ["control"], "construct_types": ["match", "try_except"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-functions", "content": "3. FUNCTIONS: def; lambda (2 forms); pipe; f-strings; glob; top-level restriction", "topic_ids": ["functions"], "construct_types": ["def"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-imports", "content": "4. IMPORTS: import; import from { }; include; __init__.jac; wrong forms", "topic_ids": ["imports"], "construct_types": ["import"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-archetypes", "content": "5. ARCHETYPES: node; edge; walker; obj; enum; inheritance; impl; postinit; can vs def", "topic_ids": ["archetypes"], "construct_types": ["node", "edge", "walker", "obj", "enum", "can"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-access", "content": "6. ACCESS: :pub :priv :protect", "topic_ids": ["access"], "construct_types": ["auth"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-graph", "content": "7. GRAPH: connect (typed/untyped); disconnect; traversal (typed/untyped); filters; variable node traversal; walrus; visit indexed", "topic_ids": ["graph"], "construct_types": ["node", "connect", "traverse", "filter", "visit"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-abilities", "content": "8. ABILITIES: can with entry/exit; self/here/visitor/root; Root type", "topic_ids": ["abilities"], "construct_types": ["visit", "can", "try_except"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-walkers", "content": "9. WALKERS: spawn; visit; report; disengage; skip", "topic_ids": ["walkers"], "construct_types": ["walker", "spawn", "visit", "report"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-by_llm", "content": "10. BY_LLM: by llm; semstrings; sem annotations; enum classification; multi-model (Model)", "topic_ids": ["by_llm"], "construct_types": ["enum", "by_llm"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-file_json", "content": "11. FILE_JSON: file.open; json.dumps/loads; keyword variable warning", "topic_ids": ["file_json"], "construct_types": ["general"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-api", "content": "12. API: jac start; walker endpoints; __specs__; :pub auth; read-only root; custom auth", "topic_ids": ["api"], "construct_types": ["walker", "api", "auth"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-websocket", "content": "13. WEBSOCKET: __specs__ methods=[\"websocket\"]; async walker; ws:// endpoint; notify", "topic_ids": ["websocket"], "construct_types": ["walker", "async", "websocket", "api"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-webhooks", "content": "14. WEBHOOKS: __specs__ webhook; endpoint path", "topic_ids": ["webhooks"], "construct_types": ["api"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-scheduler", "content": "15. SCHEDULER: __specs__ schedule; triggers", "topic_ids": ["scheduler"], "construct_types": ["api"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-async", "content": "16. ASYNC: async walker; async def; task status", "topic_ids": ["async"], "construct_types": ["walker", "async"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-permissions", "content": "17. PERMISSIONS: grant/revoke/check_access; levels", "topic_ids": ["permissions"], "construct_types": ["permissions"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-persistence", "content": "18. PERSISTENCE: auto-persist; save; commit; references; delete", "topic_ids": ["persistence"], "construct_types": ["persistence"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-testing", "content": "19. TESTING: test name { assert }; identifier names", "topic_ids": ["testing"], "construct_types": ["testing"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-stdlib", "content": "20. STDLIB: builtins; string/list/dict methods\n21. JSX/CLIENT: .cl.jac; sv import; useEffect; async def + root spawn; JS builtins; className; CSS; component def:pub; has = reactive state; JSX comprehensions; conditional rendering; form handling; component props/callbacks; routing (Router/Routes/Route/Link/Navigate/useNavigate from @jac/runtime); error/loading patterns", "topic_ids": ["stdlib"], "construct_types": ["walker", "spawn", "def", "import", "async", "jsx", "client", "auth", "routing"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-routing", "content": "22. CLIENT_AUTH: jacSignup/jacLogin/jacLogout/jacIsLoggedIn from @jac/runtime; per-user isolation\n23. JAC.TOML: all sections; tailwind config; npm deps", "topic_ids": ["routing"], "construct_types": ["client", "auth", "jac_toml"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-jac_toml", "content": "24. FULLSTACK_SETUP: jac create --use client; jac install; jac add --npm; .jac/ auto-gen; project structure (main.jac wiring, walkers.jac, frontend.cl.jac, components/*.cl.jac)", "topic_ids": ["jac_toml"], "construct_types": ["walker", "jsx", "client"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-fullstack_setup", "content": "25. DEV_SERVER: jac start --dev; ports; proxy; --no-client", "topic_ids": ["fullstack_setup"], "construct_types": ["api", "client"], "priority": 2, "category": "topic_definition"}
{"id": "rule-topic-project_structure", "content": "26. DEPLOY_ENV: docker; jaseci vs jaclang; jac start --scale; env vars; .env loading via glob trick", "topic_ids": ["project_structure"], "construct_types": ["glob", "api", "deploy", "env"], "priority": 2, "category": "topic_definition"}
